# CLAUDE.md

このファイルは AI（Claude/Copilot など）にプロジェクトの意図と前提を伝えるための開発ノートです。

## プロジェクト概要

レールあそびアプリ — TresJS + Vue + Vuetify で作る 3D レール配置ゲーム。

## 現状の機能（抜粋）

### レール系統

- レール配置（直線、カーブ（左右）、スロープ、曲線スロープ（上り・下り））
- 駅ホーム、踏切の配置
- エリア制限（床下配置防止、高さ制限）
- プリセット線路生成（円、オーバル、S字カーブ、スロープ付きオーバル）

### 電車・運行

- 電車運行（複数車両、先頭カメラビュー対応）
- 電車カスタマイズモード（色変更、プリセット対応）
- スロープでの滑らかな高度変化（ease-in-out補間）

### 景観・建築

- 木、建物、橋脚の配置
- **橋脚スマートスナップ機能**：線路接続点への自動配置、候補点の可視化
- 曲線スロープでの正確な橋脚角度計算（π/2倍数にスナップ）

### UI・操作性

- ゴーストプレビュー機能（レール、建物、橋脚候補表示）
- キーボードショートカット（R/E: 回転、Q: リセット、ESC: ツール解除）
- 手動保存・復元機能（2スロット対応）
- 自動保存機能

### 技術基盤

- TresJS/Three.js による 3D シーン
- Biome による Lint/Format、vue-tsc による型チェック
- パフォーマンス最適化（不要な再計算防止）

## 最近の改善（完了済み）

- ✅ 曲線下りスロープの床下配置防止
- ✅ 橋脚スマートスナップ機能の実装
- ✅ 橋脚角度計算の修正（曲線スロープ対応）
- ✅ パフォーマンス最適化（橋脚候補生成の効率化）

## 優先 TODO（開発メモ）

- 削除したオブジェクトがキャンバスに残るバグの解消
- 景観の増加（信号機、標識など）
- 線路接続の自動検証・修正機能

## コーディング規約

- 言語: TypeScript + Vue 3（SFC）
- Lint/Format: Biome（`npm run lint`, `npm run format`）
- 型チェック: `vue-tsc`（`npm run build` 内で実行）
- UI: Vuetify 3（必要に応じて拡張）

## アーキテクチャ

### 主要コンポーネント

- `RailPlayGame.vue`: メインゲーム画面、状態管理
- `RailPlayScene.vue`: Three.js 3Dシーン描画
- `useRailsGeometry.ts`: レール幾何計算・配置可能性判定
- `useGhostPreview.ts`: ゴーストプレビューとスマートスナップ
- `useTrainRunner.ts`: 電車の物理運動計算
- `useCameraController.ts`: カメラ制御（軌道・先頭視点）

### 座標系

- X軸: 東西方向、Z軸: 南北方向、Y軸: 高さ方向
- Three.js座標系に準拠、回転角度はY軸周り
- グリッドスナップ: 1単位（レール配置）、任意単位（建物配置）

## 類似プロジェクト

`../lunchNoCohoGaRoulette/` は TresJS + Vue + Vuetify を組み合わせたアプリ。

## 開発/実行

- 開発サーバ: `npm run dev`
- ビルド: `npm run build`
- プレビュー: `npm run preview`

## PR/ブランチ運用

1. `feat/<短い要約>` または `fix/<短い要約>` のブランチを作成
2. 小さくまとめてコミット（日本語OK）
3. PR 作成時に変更点と動作確認内容を簡潔に記載

## ライセンス

MIT
